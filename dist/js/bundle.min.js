"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}var Subject=function(e){function n(e){e.hasOwnProperty("update")&&r.push(e)}function t(e){r.forEach(function(n){n.update(e)})}var r=[].concat(_toConsumableArray(e));return Object.create({addObserver:n,notify:t})},View=function(e,n){function t(e){domElement.innerHTML=n(e)}return domElement=document.querySelector(e),Object.create({domElement:domElement,update:t})},CustomersListView=function(e){function n(e){return e.error?"<p>Não foi possível recuperar os Clientes, Tente Mais tarde</p>":0===e.length?"<p>Nenhum Cliente Cadastrado</p>":"\n      <ul>"+e.map(function(e){return'\n        <li class="customer-view" id={'+e.id+"}>\n          "+e.name+'\n          <button type="button" name="delete" value="'+e.id+'" >Deletar</button>\n          <button type="button" name="edit" value="'+e.id+'" >Editar</button>\n        </li>\n      '}).join("")+"</ul>\n    "}return Object.create(View(e,n))},HttpService=function(){function e(e){return new Promise(function(n,t){r.open("GET",u+"/"+e),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?n(JSON.parse(r.responseText)):t({error:r.status}))},r.send()})}function n(e,n){return new Promise(function(t,i){r.open("POST",u+"/"+e,!0),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(n)),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(JSON.parse(r.responseText)):i({error:r.status}))}})}function t(e,n){var t=u+"/"+e+"/"+n;return new Promise(function(e,n){r.open("DELETE",t,!0),r.onload=function(){console.log("xhr.status",r.status),4==r.readyState&&(200==r.status?e(JSON.parse(r.responseText)):n({error:r.status}))},r.send(null)})}var r=new XMLHttpRequest,u="http://localhost:3000";return Object.create({get:e,post:n,remove:t})},CustomerHttpService=function(){function e(e){if(!e)throw new Error("No custumer informed");return a.post(i,e).then(function(e){return console.log("res",e),e})["catch"](function(e){return e})}function n(){return a.get(i).then(function(e){return e})["catch"](function(e){return e})}function t(e){if(!e)throw new Error("No custumer id informed");return a.get(i+"/"+e).then(function(e){return e})["catch"](function(e){return e})}function r(e){if(!e)throw new Error("No custumer id informed");return a.update(i,e).then(function(e){return e})["catch"](function(e){return e})}function u(e){if(!e)throw new Error("No custumer id informed");return a.remove(i,e).then(function(e){return e})["catch"](function(e){return e})}var i="customers",a=HttpService();return Object.create({getAll:n,getById:t,save:e,update:r,remove:u})},CustomerController=function(){function e(e){d.notify(e)}function n(){return c.getAll().then(function(n){l=[].concat(_toConsumableArray(n)),e(n)})["catch"](function(n){return e(n)})}function t(t){return t.id?c.update(t).then(function(){return n()})["catch"](function(n){return e(n)}):c.save(t).then(function(){return n()})["catch"](function(n){return e(n)})}function r(t){return c.remove(t).then(function(){return n()})["catch"](function(n){return e(n)})}function u(e){return l.find(function(n){return+n.id===+e})}for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];var c=CustomerHttpService(),d=Subject(a),l=[];return Object.create({customerApi:c,getAllCustomers:n,save:t,remove:r,getEditingCustomer:u})},ViewController=function(e,n){function t(e){e(),r(L),u(D),i()}function r(e,n,t,r){var u=document.createElement("li"),i=document.createElement("input"),a=document.createElement("input"),o=document.createElement("input"),c=document.createElement("input"),d=document.createElement("label"),l=document.createElement("input"),s=document.createElement("label");i.value=n,i.hidden=!0,c.type="checkbox",d.append(c),d.append("Excluir"),a.value=t||"",a.type="text",o.value=r||"",o.type="text",l.type="radio",l.name="mainPhone",s.append(l),s.append("Principal"),u.append(i),u.append(d),u.append(a),u.append(o),u.append(s),e.appendChild(u)}function u(e,n,t){var r=document.createElement("li"),u=document.createElement("input"),i=document.createElement("input"),a=document.createElement("input"),o=document.createElement("label");u.value=n,u.hidden=!0,i.value=t||"",i.type="email",a.type="checkbox",o.append(a),o.append("Excluir"),r.append(u),r.append(o),r.append(i),e.appendChild(r)}function i(){z.addEventListener("click",function(){return r(L)}),G.addEventListener("click",function(){return u(D)})}function a(){var e=!1;return e=!!(o()&c()&d()&l()&s()&m()&p()&f())}function o(){return j.value?(X.hidden=!0,!0):(X.hidden=!1,!1)}function c(){return k.value?(K.hidden=!0,!0):(K.hidden=!1,!1)}function d(){if(!k.value)return!0;var e=(new Date).getFullYear()-new Date(k.value).getFullYear();return e<18||(P.value&&T.value?(Q.hidden=!0,!0):(Q.hidden=!1,!1))}function l(){return N.value?(U.hidden=!0,!0):(U.hidden=!1,!1)}function s(){return _.value?(W.hidden=!0,!0):(W.hidden=!1,!1)}function m(){var e=S(L).filter(function(e){return!e.destroy});return $.hidden=!0,Z.hidden=!0,ue.hidden=!0,e.length<1?(Z.hidden=!1,!1):e.length>4?($.hidden=!1,!1):!!e.find(function(e){return!e.code||!e.number})&&(ue.hidden=!1,!1)}function p(){var e=w(D).filter(function(e){return!e.destroy&&e.address});return console.log("emails",e),ee.hidden=!0,ne.hidden=!0,e.length<1?(ee.hidden=!1,!1):e.length>3&&(ne.hidden=!1,!1)}function f(){var e=!1,n=!1;return M.value?te.hidden=!0:(te.hidden=!1,e=!0),F.value&&R.value?re.hidden=!0:(re.hidden=!1,n=!0),!e&&!n}function v(e){return V.addEventListener("submit",function(e){e.preventDefault();var n=E(V.elements);console.log("formValue",n),a()})}function h(e){return O.addEventListener("click",function(n){if("button"===n.target.type&&"delete"===n.target.name){var t=confirm("Tem certeza que deseja excluir o usuário?");t&&e(n.target.value)}})}function y(e){return O.addEventListener("click",function(n){if("button"===n.target.type&&"edit"===n.target.name){var t=e(n.target.value);q.value=t.id,j.value=t.name,k.value=t.birthday,N.value=t.state,_.value=t.city||"",t.driver_license?(B.value=t.driver_license.id,P.value=t.driver_license.number,T.value=t.driver_license.issued_at,x.checked=!1):(P.value="",T.value="",x.checked=!1),M.value="",F.value="",R.value="",t.parent&&(H.value=t.parent.id,M.value=t.parent.name,J.value=t.parent.phone.id,F.value=t.parent.phone.code,R.value=t.parent.phone.number,Y.checked=!1),C(L,t.phones),I(D,t.emails)}})}function E(){return q.value?b():g()}function b(){return{id:q.value,name:j.value,birthday:k.value,driver_license:{id:licenseId.value,number:P.value,issued_at:T.value,destroy:x.checked},state:N.value,city:_.value,phones:S(L,!1),emails:w(D,!1),parent:{id:H.value,name:M.value,destroy:Y.checked,phone:{id:J.value,code:F.value,number:R.value}}}}function g(){return{name:j.value,birthday:k.value,driver_license:{number:P.value,issued_at:T.value},state:N.value,city:_.value,phones:S(L),emails:w(D),parent:{name:M.value,phone:{code:F.value,number:R.value}}}}function S(e,n){var t=e.querySelectorAll("li"),r=Object.keys(t).map(function(e){return t[e]}).map(function(e){return{destroy:e.querySelectorAll("input")[1].checked,code:e.querySelectorAll("input")[2].value,number:e.querySelectorAll("input")[3].value,main_number:e.querySelectorAll("input")[4].checked}}).map(function(e){return n?Object.assign(e,{id:li.querySelectorAll("input")[0].value}):e});return r}function w(e,n){var t=e.querySelectorAll("li"),r=Object.keys(t).map(function(e){return t[e]}).map(function(e){return{destroy:e.querySelectorAll("input")[1].checked,address:e.querySelectorAll("input")[2].value}}).map(function(e){return n?Object.assign(e,{id:li.querySelectorAll("input")[0].value}):e});return r}function A(e){return document.querySelector(e)}function C(e,n){e.innerHTML="",n.forEach(function(n){return r(e,n.id,n.code,n.number)})}function I(e,n){e.innerHTML="",n.forEach(function(n){return u(e,n.id,n.address)})}var V=document.querySelector(e),O=document.querySelector(n),q=A("#id"),j=A("#name"),k=A("#birthday"),B=A("#licenseId"),P=A("#licenseDate"),T=A("#licenseIssueAt"),x=A("#licenseDestroy"),N=A("#state"),_=A("#city"),L=A("#phones"),D=A("#emails"),H=A("#parentId"),M=A("#parentName"),J=A("#parentPhoneId"),F=A("#parentPhoneCode"),R=A("#parentPhoneNumber"),Y=A("#parentDestroy"),z=A("#addMorePhonesBtn"),G=A("#addMoreEmailBtn"),X=document.getElementById("nameValidation"),K=document.getElementById("birthdayValidation"),Q=document.getElementById("licenseValidation"),U=document.getElementById("stateValidation"),W=document.getElementById("cityValidation"),Z=document.getElementById("minPhoneValidation"),$=document.getElementById("maxPhoneValidation"),ee=document.getElementById("minEmailValidation"),ne=document.getElementById("maxEmailValidation"),te=document.getElementById("parentNameValidation"),re=document.getElementById("parentPhoneValidation"),ue=document.getElementById("phoneValidation");return Object.create({onInit:t,onSubmit:v,onDelete:h,onSendToEdit:y})};!function(){var e=ViewController("#form-view","#customers-view"),n=CustomersListView("#customers-view"),t=CustomerController(n);e.onInit(t.getAllCustomers),e.onSubmit(t.save),e.onDelete(t.remove),e.onSendToEdit(t.getEditingCustomer)}();